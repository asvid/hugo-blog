<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.91ae35f985ba4ae6473b8defee39551f3ce6ed2769fdfa9b3df93f2eac0da4bc.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/assets/favicon.ico>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Adam Świderski - Kotlin Template Method</title>
<meta property="og:title" content=Adam&#32;Świderski&#32;-&#32;Kotlin&#32;Template&#32;Method />
<meta name="twitter:title" content=Adam&#32;Świderski&#32;-&#32;Kotlin&#32;Template&#32;Method />
<meta itemprop="name" content=Adam&#32;Świderski&#32;-&#32;Kotlin&#32;Template&#32;Method />
<meta name="application-name" content=Adam&#32;Świderski&#32;-&#32;Kotlin&#32;Template&#32;Method />
<meta property="og:site_name" content="Adam Coding Corner" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="//localhost:1313/kotlin-template-method/" />
<link rel="canonical" href="//localhost:1313/kotlin-template-method/" itemprop="url" />
<meta name="url" content="//localhost:1313/kotlin-template-method/" />
<meta name="twitter:url" content="//localhost:1313/kotlin-template-method/" />
<meta property="og:url" content="//localhost:1313/kotlin-template-method/" />


<meta property="og:updated_time" content=13005-13-12T50:00:21Z />


<link rel="sitemap" type="application/xml" title="Sitemap" href='//localhost:1313/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />


<meta name="twitter:site" content="" />
<meta name="twitter:creator" content="" />
<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Adam Coding Corner" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />





<meta property="og:type" content="article" />
<meta property="article:publisher" content="" />
<meta property="og:article:published_time" content=13005-13-12T50:00:21Z />
<meta property="article:published_time" content=13005-13-12T50:00:21Z />








<meta name="generator" content="Hugo 0.123.7">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.684be08038c8e02f27eed57328c70b4a2b8156ece14b38d3a7c0d860ea16edb9.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #bebebe;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="//localhost:1313/">
                <img src="/assets/profile_picture.png" alt="brand image">
            </a>
        
        
            <a href="//localhost:1313/">
                <h1>Adam Świderski</h1>
            </a>
        
    </h1>
    <p class="lead">
    software engineer
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">
        
        
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/about/">About</a>
                    </li>
                    
                
            
                
                
            
                
                
            
            
                
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="/posts/">Posts</a>
                    </li>
                    
                        <li class="sub-heading">
                            Recent
                        </li>
                        
                            <li class="bullet">
                                <a href="//localhost:1313/2024-02-24-MVI/">Android Presentation Patterns: MVI</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="//localhost:1313/2024-02-09-MVVM/">Android Presentation Patterns: MVVM</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="//localhost:1313/2024-01-29-MVP/">Android Presentation Patterns: MVP</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="//localhost:1313/2024-01-27-MVC/">Android Presentation Patterns: MVC</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="//localhost:1313/2023-06-16-ci-is-your-friend/">Continuous Integration and Deployment: A Developer&#39;s Best Friends</a>
                            </li>
                        
                    
                
            
                
                
            
            
                
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://linkedin.com">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>






    <a target="_blank" class="social" title="YouTube" href="https://youtube.com">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12.006 19.012h-.02c-.062 0-6.265-.012-7.83-.437a2.5 2.5 0 0 1-1.764-1.765A26.494 26.494 0 0 1 1.986 12a26.646 26.646 0 0 1 .417-4.817A2.564 2.564 0 0 1 4.169 5.4c1.522-.4 7.554-.4 7.81-.4H12c.063 0 6.282.012 7.831.437c.859.233 1.53.904 1.762 1.763c.29 1.594.427 3.211.407 4.831a26.568 26.568 0 0 1-.418 4.811a2.51 2.51 0 0 1-1.767 1.763c-1.52.403-7.553.407-7.809.407Zm-2-10.007l-.005 6l5.212-3l-5.207-3Z"/>
        </svg>
    </a>








    <a target="_blank" class="social" title="RSS Feed" href="/posts/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>


    <a target="_blank" class="social" title="Email" href="mailto://user@domain">
       <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211">
            <path fill="currentColor" d="M301.393,241.631L464.866,424.56H20.332l163.474-182.928l58.801,51.443L301.393,241.631z M462.174,60.651H23.027 l219.579,192.142L462.174,60.651z M324.225,221.67l160.986,180.151V80.792L324.225,221.67z M0,80.792v321.029L160.972,221.64 L0,80.792z"/>
       </svg>
    </a>


        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 Adam Coding Corner. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="//localhost:1313/kotlin-template-method/">Kotlin Template Method</a>
  </h1>

  <div class="headline">
    <div>
      
      <time datetime=" 2021-05-13T00:00:00Z" class="post-date">
        May 13, 2021
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>11 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-design patterns">
        <a href="//localhost:1313/tags/design-patterns">design patterns</a>
      </li>
      
      <li class="tag-Kotlin">
        <a href="//localhost:1313/tags/kotlin">Kotlin</a>
      </li>
      
      <li class="tag-Template Method">
        <a href="//localhost:1313/tags/template-method">Template Method</a>
      </li>
      
      <li class="tag-behavioral design pattern">
        <a href="//localhost:1313/tags/behavioral-design-pattern">behavioral design pattern</a>
      </li>
      
    </ul>
    
  </div>

  
  
  <p class="seriesname">
    Series: <a href="//localhost:1313/series/kotlin-design-patterns">Kotlin Design Patterns</a>
  </p>
  

  
</div>

  <h1 id="purpose">Purpose</h1>
<p>The template method is a very simple design pattern, that separates the shared class parts from distinctive ones. The core idea is to have an abstract parent class containing the algorithm steps and allowing inheriting classes to overwrite individual steps, but not the algorithm that uses those steps itself.</p>
<p>Think about Pizza - steps to make it are more-less the same, despite the type of pizza. You need to make a dough, apply sauce and ingredients, and finally bake it. Different types of pizza may have a different dough, sauce, or baking time (I guess, I don&rsquo;t know how to make pizza :) ), but the order and steps would be always the same. So we can agree that there is an abstract <code>Pizza</code> with a method <code>make()</code>, but inheriting classes like <code>Pepperoni</code> or <code>Hawaiian</code> will override methods applying ingredients, without changing the algorithm of making pizza.</p>
<p>We are having here the inversion of control, because parent class <code>Pizza</code> is calling overridden methods from inheriting class, and not the other way around (child class calling abstract parent methods).</p>
<p>Template methods may be seen in libraries when the creator allows extending library classes and overriding some methods, but maintain control over calling those methods.</p>
<h1 id="implementation-examples">Implementation examples</h1>
<h2 id="basic">Basic</h2>
<p>Let&rsquo;s start with a generic example, picturing what this pattern is about:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AbstractClass</span> { <span style="color:#75715e">// parent class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// you cant override this method because it&#39;s not `open`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">templateMethod</span>() { <span style="color:#75715e">// the Template Method, so the algorithm with ordered steps
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;running template method&#34;</span>)
</span></span><span style="display:flex;"><span>        primitiveOperation1() <span style="color:#75715e">// calling algorithm steps
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        primitiveOperation2()
</span></span><span style="display:flex;"><span>        primitiveOperation3()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">primitiveOperation1</span>() <span style="color:#75715e">// algorithm step to be overridden by concrete class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">primitiveOperation2</span>() { <span style="color:#75715e">// algorithm step not to be overridden
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;doing abstract operation 2&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">primitiveOperation3</span>() <span style="color:#75715e">// another step
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConcreteClass</span> : AbstractClass() { <span style="color:#75715e">// concrete class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">primitiveOperation1</span>() { <span style="color:#75715e">// step implementation for concrete class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;doing concrete operation 1&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">primitiveOperation3</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;doing concrete operation 3&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AnotherConcreteClass</span> : AbstractClass() { <span style="color:#75715e">// another concrete class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">primitiveOperation1</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;doing concrete operation 1&#34;</span>) <span style="color:#75715e">// not cool duplicated implementation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">primitiveOperation3</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;doing another concrete operation 3&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We have here a <code>templateMethod()</code> in the abstract class, so our algorithm or rather list of steps, where each step is a method call representing a primitive operation. Those operations may have a default implementation already in the abstract class or require providing an implementation in inheriting classes. The term &ldquo;primitive&rdquo; is used for operations to suggest they are just steps and not the algorithm, and that their implementation can be replaced in concrete classes.</p>
<p>The Template method can&rsquo;t be overridden by inheriting classes. This would be possible if <code>templateMethod()</code> would be <code>open</code>, but Kotlin encourages encapsulation so by default methods and classes are <code>final</code>. Overriding <code>templateMethod()</code> would mean changing the algorithm, and its constant form is the reason for the Template Method pattern to be used. If there is a need to change the algorithm, maybe it&rsquo;s better to use a pattern like <code>Strategy</code>.</p>
<h2 id="pizza">Pizza</h2>
<p>Now let&rsquo;s look into more graphic example: <strong>Pizza</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Pizza</span> { <span style="color:#75715e">// base class for all pizza types
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">make</span>() { <span style="color:#75715e">// steps are the same for every pizza
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        makeDough()
</span></span><span style="display:flex;"><span>        applySauce()
</span></span><span style="display:flex;"><span>        addIngredients()
</span></span><span style="display:flex;"><span>        bake()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">open</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">bake</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// default implementation for each step
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#75715e">// concrete classes needs to override only the distinctive ones
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;baking for 20 minutes&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">open</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">addIngredients</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding cheese&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">open</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">applySauce</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;applying tomato sauce&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">open</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">makeDough</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;making 30cm dough&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Pepperoni</span> : Pizza() { <span style="color:#75715e">// concrete type of pizza
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">addIngredients</span>() { <span style="color:#75715e">// overriding ingredients according to recipe
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;adding salami&#34;</span>)
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding onion&#34;</span>)
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding cheese&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// but it&#39;s not controlling the process of making a pizza
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// all other methods are left with default implementation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BigPepperoni</span> : Pizza() { <span style="color:#75715e">// same as previous but bigger
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">addIngredients</span>() { <span style="color:#75715e">// alas, duplicated implementation from previous class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;adding salami&#34;</span>)
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding onion&#34;</span>)
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding cheese&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">makeDough</span>() { <span style="color:#75715e">// the only difference from standard pepperoni
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;making 50cm dough&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Class <code>Pizza</code> contains shared steps for all types of pizza. Concrete types of pizza override only the distinctive steps, for example, pizza size, ingredients, or sauce. There is a problem though with sharing method implementation between <code>Pepperoni</code> and <code>BigPepperoni</code> classes - they have the same ingredients but <code>BigPepperoni</code> has a bigger dough size. It may seem that <code>BigPepperoni</code> should just extend the <code>Pepperoni</code> class and override just the <code>makeDough()</code> method. Then <code>Pepperoni</code> would need to be <code>open</code> and it would create another level of inheritance. You can easily imagine an ongoing class explosion where every pizza type has 3 sizes and 2 sauces to choose from. It may look like the reason to use the <code>Factory</code> pattern&hellip;</p>
<h3 id="pizza-lambdas">Pizza Lambdas</h3>
<p>Instead of overriding methods of base class <code>Pizza</code> interface, we can try to make use of passing lambdas in the constructor:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Pizza</span>( <span style="color:#75715e">// base class constructor is taking lambdas but provides default implementation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> makeDough: () <span style="color:#f92672">-&gt;</span> Unit = {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;making 30cm dough&#34;</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> applySauce: () <span style="color:#f92672">-&gt;</span> Unit = {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;applying tomato sauce&#34;</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> addIngredients: () <span style="color:#f92672">-&gt;</span> Unit = {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding cheese&#34;</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> bake: () <span style="color:#f92672">-&gt;</span> Unit = {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;baking for 20 minutes&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">make</span>() { <span style="color:#75715e">// unchanged template method
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        makeDough() <span style="color:#75715e">// calling lambda parameter from constructor that can be replaced
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        applySauce()
</span></span><span style="display:flex;"><span>        addIngredients()
</span></span><span style="display:flex;"><span>        bake()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Pepperoni</span> : Pizza( <span style="color:#75715e">// concrete class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    addIngredients = { <span style="color:#75715e">// passing lambda overriding default implementation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;adding salami&#34;</span>)
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding onion&#34;</span>)
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding cheese&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BigPepperoni</span> : Pizza(
</span></span><span style="display:flex;"><span>    addIngredients = { <span style="color:#75715e">// duplicated implementation, again
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;adding salami&#34;</span>)
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding onion&#34;</span>)
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding cheese&#34;</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    makeDough = { <span style="color:#75715e">// dough size lambda replaced
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;making 50cm dough&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>Looks way more Kotlin style :) In the book <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> Joshua Bloch mentions that after Java incorporated lambdas, the <code>Template Method</code> pattern became irrelevant. It is more convenient to inject behavior as lambdas in the base class constructor than create concrete classes overriding selected methods.</p>
<p>There is still a problem with duplicated implementation. It&rsquo;s possible to keep common implementation inside a variable and pass it to all classes that require it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> pepperoniAddons: () <span style="color:#f92672">-&gt;</span> Unit = { <span style="color:#75715e">// functions are first class citizens
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    println(<span style="color:#e6db74">&#34;adding salami&#34;</span>)
</span></span><span style="display:flex;"><span>    println(<span style="color:#e6db74">&#34;adding onion&#34;</span>)
</span></span><span style="display:flex;"><span>    println(<span style="color:#e6db74">&#34;adding cheese&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Pepperoni</span> : Pizza(
</span></span><span style="display:flex;"><span>    addIngredients = pepperoniAddons <span style="color:#75715e">// passing the lambda
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BigPepperoni</span> : Pizza(
</span></span><span style="display:flex;"><span>    addIngredients = pepperoniAddons, <span style="color:#75715e">// passing the same lambda
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    makeDough = {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;making 50cm dough&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>It works. But passing in every parameter the generic lambda <code>() -&gt; Unit</code> is not really safe and allows stupid errors to happen, like wrong argument order. It can be partially avoided with using named arguments.</p>
<h3 id="pizza-interfaces">Pizza interfaces</h3>
<p>Assuming primitive operations are not returning anything, and just changing the Pizza instance, it&rsquo;s safer to use concrete interfaces corresponding to algorithm steps.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">DoughMaker</span> { <span style="color:#75715e">// algorithm step interface
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">operator</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() { <span style="color:#75715e">// this allows to use interface instance as lambda
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		println(<span style="color:#e6db74">&#34;making dough&#34;</span>) <span style="color:#75715e">// default implementation, Kotlin allows it inside interfaces
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">SauceApplier</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">operator</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>		println(<span style="color:#e6db74">&#34;applying sauce&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">AddonsApplier</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">operator</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>		println(<span style="color:#e6db74">&#34;applying addons&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Baker</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">operator</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>		println(<span style="color:#e6db74">&#34;baking&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Having such interfaces, abstract class <code>Pizza</code> may look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Pizza</span>(
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// distinctive types makes passing arguments easy, no need to remember order
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> makeDough: DoughMaker = <span style="color:#66d9ef">object</span> <span style="color:#960050;background-color:#1e0010">: </span><span style="color:#a6e22e">DoughMaker</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>            println(<span style="color:#e6db74">&#34;making 30cm dough&#34;</span>) <span style="color:#75715e">// overridden default implementation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> applySauce: SauceApplier = <span style="color:#66d9ef">object</span> <span style="color:#960050;background-color:#1e0010">: </span><span style="color:#a6e22e">SauceApplier</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>            println(<span style="color:#e6db74">&#34;applying tomato sauce&#34;</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> addIngredients: AddonsApplier = <span style="color:#66d9ef">object</span> <span style="color:#960050;background-color:#1e0010">: </span><span style="color:#a6e22e">AddonsApplier</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>            println(<span style="color:#e6db74">&#34;adding cheese&#34;</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> bake: Baker = <span style="color:#66d9ef">object</span> <span style="color:#960050;background-color:#1e0010">: </span><span style="color:#a6e22e">Baker</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>            println(<span style="color:#e6db74">&#34;baking for 20 minutes&#34;</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">make</span>() { <span style="color:#75715e">// the same Template Method
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        makeDough() <span style="color:#75715e">// here we don&#39;t run lambda, but the `invoke()` method of the interface
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        applySauce()
</span></span><span style="display:flex;"><span>        addIngredients()
</span></span><span style="display:flex;"><span>        bake()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Concrete classes may have the same objects implementing interface injected, resolving problem with duplicated code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">PepperoniAddonsApplier</span> : <span style="color:#a6e22e">Pizza</span>.AddonsApplier { <span style="color:#75715e">// common object for all Pepperoni pizza sizes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding salami&#34;</span>)
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding onion&#34;</span>)
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;adding cheese&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">BigPizzaDoughMaker</span> : <span style="color:#a6e22e">Pizza</span>.DoughMaker { <span style="color:#75715e">// sizing object can be used with all Pizza types
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;making 50cm dough&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Pepperoni</span> : Pizza(
</span></span><span style="display:flex;"><span>    addIngredients = PepperoniAddonsApplier
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BigPepperoni</span> : Pizza(
</span></span><span style="display:flex;"><span>    addIngredients = PepperoniAddonsApplier,
</span></span><span style="display:flex;"><span>    makeDough = BigPizzaDoughMaker
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>This allows you to create totally custom Pizza, without creating a concrete class:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> customPizza = <span style="color:#66d9ef">object</span> <span style="color:#960050;background-color:#1e0010">: </span><span style="color:#a6e22e">Pizza</span>(
</span></span><span style="display:flex;"><span>	applySauce = <span style="color:#66d9ef">object</span> <span style="color:#960050;background-color:#1e0010">: </span><span style="color:#a6e22e">SauceApplier</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>			println(<span style="color:#e6db74">&#34;adding super sauce&#34;</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>	makeDough = <span style="color:#66d9ef">object</span> <span style="color:#960050;background-color:#1e0010">: </span><span style="color:#a6e22e">DoughMaker</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>			println(<span style="color:#e6db74">&#34;making super dough 48cm&#34;</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>	addIngredients = <span style="color:#66d9ef">object</span> <span style="color:#960050;background-color:#1e0010">: </span><span style="color:#a6e22e">AddonsApplier</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>			println(<span style="color:#e6db74">&#34;no addons, its super by itself&#34;</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>	bake = <span style="color:#66d9ef">object</span> <span style="color:#960050;background-color:#1e0010">: </span><span style="color:#a6e22e">Baker</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">invoke</span>() {
</span></span><span style="display:flex;"><span>			println(<span style="color:#e6db74">&#34;I like it raw&#34;</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>) {}
</span></span><span style="display:flex;"><span>customPizza.make()
</span></span></code></pre></div><blockquote>
<p>Is it still a <code>Template Method</code> or rather a <code>Strategy</code>?</p>
</blockquote>
<h2 id="active-record">Active Record</h2>
<p>This example is taken from the world of Ruby (that I&rsquo;m not familiar with), where it came from a pattern proposed by Martin Folwer in book <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>. In general, you have a class - a model in MVC understanding, that contains data and also methods to manipulate and save this object in database. More about <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>.</p>
<p>In <code>Ruby on Rails</code> that kind of model also has a lot of callbacks <sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup> or so-called hooks, that are called before saving to DB or in case of an error. This is exactly where <code>Template Method</code> fits perfectly. In Kotlin, it can be implemented like that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ActiveRecord</span> { <span style="color:#75715e">// base ActiveRecord class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// template method calling hooks in right order
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">save</span>() { <span style="color:#75715e">// the generic save to DB method
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;saving record </span><span style="color:#e6db74">$this</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.beforeSave() <span style="color:#75715e">// calling hook
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> isSuccess = <span style="color:#a6e22e">DB</span>.save(<span style="color:#66d9ef">this</span>) <span style="color:#75715e">// saving to DB may be success or fail
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (isSuccess) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.afterSave() <span style="color:#75715e">// calling hook on success
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.failedSave() <span style="color:#75715e">// and another one for error
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">open</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">beforeSave</span>() { <span style="color:#75715e">// hook with default implementation, open to be overridden
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// NOOP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;NOOP beforeSave()&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">open</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">afterSave</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// NOOP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;NOOP afterSave()&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">open</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">failedSave</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// NOOP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;NOOP failedSave()&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DB</span> { <span style="color:#75715e">// some stub of DB
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">save</span>(record: ActiveRecord): Boolean {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;DB is saving record: </span><span style="color:#e6db74">$record</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// here would be saving entity in DB and returning if it was successful or not
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> username: String) : ActiveRecord() { <span style="color:#75715e">// concrete model extending ActiveRecord
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">beforeSave</span>() { <span style="color:#75715e">// hook is overridden
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$this</span><span style="color:#e6db74"> beforeSave()&#34;</span>)
</span></span><span style="display:flex;"><span>        sanitizeRecord() <span style="color:#75715e">// calling fixing the data before its saved in DB
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">sanitizeRecord</span>() { <span style="color:#75715e">// fixing model data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$this</span><span style="color:#e6db74"> sanitizeRecord()&#34;</span>)
</span></span><span style="display:flex;"><span>        username.trim()
</span></span><span style="display:flex;"><span>        username = username.filter { <span style="color:#66d9ef">it</span>.isLetter() }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Post</span>(<span style="color:#66d9ef">val</span> text: String) : ActiveRecord() <span style="color:#75715e">// another model, without hooks
</span></span></span></code></pre></div><p>Having <code>ActiveRecord</code> constructed with hooks in mind, you can easily plugin for example logging, error handling, or fixing data before it&rsquo;s saved in DB. A very similar idea is used in <code>JUnit</code> tests, where you have methods annotated with <code>@BeforeEach</code> or <code>@AfterAll</code>, to run some actions before each test, or clean up after all of them are done.</p>
<p><code>ActiveRecord</code> itself is sometimes called as <sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> and there are good reasons for it: SRP violation (single class to keep data, DB operations, validate model, etc.), direct mapping DB structure to model fields, troubles with testing. But as I mentioned - Ruby is not my world, and this post is not about <code>ActiveRecord</code>, just <code>Template Method</code> fits nicely for this case.</p>
<h1 id="summary">Summary</h1>
<p>The <code>Template Method</code> pattern is simple in design, and I think I was using it without even knowing that it has a name. The pattern creates a template of the algorithm, and at the same time requires (or just allows to) override its steps in concrete class (see Pizza examples).</p>
<p>Despite its simple construction and a bit archaic approach it still has its place in modern projects, especially libraries. It has some shortcomings, that can be overcome with using lambdas or injecting whole objects, but then it becomes more a <code>Strategy</code> than <code>Template Method</code>. It&rsquo;s not necessarily bad, but it&rsquo;s something you should be aware of. This might not be the best pattern to use in every case when you have a family of classes with some shared behavior. But for implementing hooks it seems perfect.</p>
<h2 id="pros">Pros</h2>
<ul>
<li>fairly simple implementation for a class family with only some distinctive behaviors but shared core</li>
<li>interesting use-case with <code>ActiveRecord</code>, well suited for hooks</li>
<li>maintaining control over method call order, even when objects are being extended, useful for library creators</li>
</ul>
<h2 id="cons">Cons</h2>
<ul>
<li>potential class explosion</li>
<li>inheriting class needs to know a bit about the parent to know which methods to override, where to call <code>super()</code> etc.</li>
<li>inheritance instead of composition, change to injecting lambdas in the constructor is creating a <code>Strategy</code>-like construction</li>
</ul>
<hr>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://books.google.pl/books/about/Effective_Java.html?id=ka2VUBqHiWkC&amp;redir_esc=y" target="_blank">&ldquo;Effective Java&rdquo;</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://books.google.pl/books?id=FyWZt5DdvFkC&amp;q=active&#43;record&amp;pg=PT187&amp;redir_esc=y" target="_blank">&ldquo;Patterns of Enterprise Application Architecture&rdquo;</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p><a href="https://en.wikipedia.org/wiki/Active_record_pattern" target="_blank">Active Record</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p><a href="https://guides.rubyonrails.org/active_record_callbacks.html" target="_blank">Active Record in Ruby</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p><a href="https://www.mehdi-khalili.com/orm-anti-patterns-part-1-active-record" target="_blank">antipattern</a>&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

  
  <hr>
<div class="footer">
    
    
    
    <p>
    This is a post in the <b><a href="//localhost:1313/series/kotlin-design-patterns">Kotlin Design Patterns</a></b> series.
        <br>Other posts in this series:
        <ul class="series">
            
            
            
            <li>
                August 22, 2021 -
                
                    <a href="/kotlin-command-pattern/">Command Pattern in Kotlin</a>
                
            </li>
            
            <li>
                July 17, 2021 -
                
                    <a href="/kotlin_mediator_pattern/">Mediator in Kotlin</a>
                
            </li>
            
            <li>
                July 3, 2021 -
                
                    <a href="/kotlin-decorator-pattern/">Decorator Pattern in Kotlin</a>
                
            </li>
            
            <li>
                June 26, 2021 -
                
                    <a href="/kotlin-adapter-pattern/">Adapter Pattern in Kotlin</a>
                
            </li>
            
            <li>
                June 7, 2021 -
                
                    <a href="/kotlin-facade-pattern/">Facade Pattern in Kotlin</a>
                
            </li>
            
            <li>
                May 30, 2021 -
                
                    <a href="/kotlin-strategy-pattern/">Strategy Pattern in Kotlin</a>
                
            </li>
            
            <li>
                May 13, 2021 -
                
                    Kotlin Template Method
                
            </li>
            
            <li>
                March 2, 2021 -
                
                    <a href="/kotlin-abstract-factory/">Kotlin Abstract Factory</a>
                
            </li>
            
            <li>
                February 26, 2021 -
                
                    <a href="/kotlin-factory-method/">Kotlin Factory Method</a>
                
            </li>
            
            <li>
                February 14, 2021 -
                
                    <a href="/kotlin-static-factory-methods/">Kotlin Static Factory Methods</a>
                
            </li>
            
            <li>
                January 29, 2021 -
                
                    <a href="/kotlin-builder-pattern/">Kotlin Builder Pattern</a>
                
            </li>
            
        </ul>
    </p>
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#basic">Basic</a></li>
    <li><a href="#pizza">Pizza</a>
      <ul>
        <li><a href="#pizza-lambdas">Pizza Lambdas</a></li>
        <li><a href="#pizza-interfaces">Pizza interfaces</a></li>
      </ul>
    </li>
    <li><a href="#active-record">Active Record</a></li>
  </ul>

  <ul>
    <li><a href="#pros">Pros</a></li>
    <li><a href="#cons">Cons</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>


