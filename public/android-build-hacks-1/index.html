<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.91ae35f985ba4ae6473b8defee39551f3ce6ed2769fdfa9b3df93f2eac0da4bc.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/assets/favicon.ico>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Adam Świderski - Android Build Hacks #1 - build basics</title>
<meta property="og:title" content=Adam&#32;Świderski&#32;-&#32;Android&#32;Build&#32;Hacks&#32;#1&#32;-&#32;build&#32;basics />
<meta name="twitter:title" content=Adam&#32;Świderski&#32;-&#32;Android&#32;Build&#32;Hacks&#32;#1&#32;-&#32;build&#32;basics />
<meta itemprop="name" content=Adam&#32;Świderski&#32;-&#32;Android&#32;Build&#32;Hacks&#32;#1&#32;-&#32;build&#32;basics />
<meta name="application-name" content=Adam&#32;Świderski&#32;-&#32;Android&#32;Build&#32;Hacks&#32;#1&#32;-&#32;build&#32;basics />
<meta property="og:site_name" content="My New Hugo Site" />


<meta name="description" content="Android build file tricks and hacks I&#39;ve found at blogposts, YT videos etc." />
<meta itemprop="description" content="Android build file tricks and hacks I&#39;ve found at blogposts, YT videos etc." />
<meta property="og:description" content="Android build file tricks and hacks I&#39;ve found at blogposts, YT videos etc." />
<meta name="twitter:description" content="Android build file tricks and hacks I&#39;ve found at blogposts, YT videos etc." />


<base href="http://localhost:1313/android-build-hacks-1/" />
<link rel="canonical" href="http://localhost:1313/android-build-hacks-1/" itemprop="url" />
<meta name="url" content="http://localhost:1313/android-build-hacks-1/" />
<meta name="twitter:url" content="http://localhost:1313/android-build-hacks-1/" />
<meta property="og:url" content="http://localhost:1313/android-build-hacks-1/" />


<meta property="og:updated_time" content=23007-23-10T724:27:18Z />


<link rel="sitemap" type="application/xml" title="Sitemap" href='http://localhost:1313/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />


<meta name="twitter:site" content="" />
<meta name="twitter:creator" content="" />
<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="My New Hugo Site" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />





<meta property="og:type" content="article" />
<meta property="article:publisher" content="" />
<meta property="og:article:published_time" content=23007-23-10T724:27:18Z />
<meta property="article:published_time" content=23007-23-10T724:27:18Z />








<meta name="generator" content="Hugo 0.123.7">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.bf4d3110fcd0b7ca2963d5dd630cbb2027b3ec79bd2a1a7a02f8244546d16737.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #bebebe;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="http://localhost:1313/">
                <img src="/assets/profile_picture.png" alt="brand image">
            </a>
        
        
            <a href="http://localhost:1313/">
                <h1>Adam Świderski</h1>
            </a>
        
    </h1>
    <p class="lead">
    software engineer
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
            
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/posts/">Posts</a>
                    </li>
                    
                        <li class="sub-heading">
                            Recent
                        </li>
                        
                            <li class="bullet">
                                <a href="http://localhost:1313/2024-02-24-MVI/">Android Presentation Patterns: MVI</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="http://localhost:1313/2024-02-09-MVVM/">Android Presentation Patterns: MVVM</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="http://localhost:1313/2024-01-29-MVP/">Android Presentation Patterns: MVP</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="http://localhost:1313/2024-01-27-MVC/">Android Presentation Patterns: MVC</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="http://localhost:1313/2023-06-16-ci-is-your-friend/">Continuous Integration and Deployment: A Developer&#39;s Best Friends</a>
                            </li>
                        
                    
                
            
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://linkedin.com">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>






    <a target="_blank" class="social" title="YouTube" href="https://youtube.com">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12.006 19.012h-.02c-.062 0-6.265-.012-7.83-.437a2.5 2.5 0 0 1-1.764-1.765A26.494 26.494 0 0 1 1.986 12a26.646 26.646 0 0 1 .417-4.817A2.564 2.564 0 0 1 4.169 5.4c1.522-.4 7.554-.4 7.81-.4H12c.063 0 6.282.012 7.831.437c.859.233 1.53.904 1.762 1.763c.29 1.594.427 3.211.407 4.831a26.568 26.568 0 0 1-.418 4.811a2.51 2.51 0 0 1-1.767 1.763c-1.52.403-7.553.407-7.809.407Zm-2-10.007l-.005 6l5.212-3l-5.207-3Z"/>
        </svg>
    </a>








    <a target="_blank" class="social" title="RSS Feed" href="/posts/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>


    <a target="_blank" class="social" title="Email" href="mailto://user@domain">
       <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211">
            <path fill="currentColor" d="M301.393,241.631L464.866,424.56H20.332l163.474-182.928l58.801,51.443L301.393,241.631z M462.174,60.651H23.027 l219.579,192.142L462.174,60.651z M324.225,221.67l160.986,180.151V80.792L324.225,221.67z M0,80.792v321.029L160.972,221.64 L0,80.792z"/>
       </svg>
    </a>


        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 My New Hugo Site. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="http://localhost:1313/android-build-hacks-1/">Android Build Hacks #1 - build basics</a>
  </h1>

  <div class="headline">
    <div>
      
      <time datetime=" 2018-07-23T22:24:27Z" class="post-date">
        July 23, 2018
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>11 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-Android">
        <a href="http://localhost:1313/tags/android">Android</a>
      </li>
      
      <li class="tag-Gradle">
        <a href="http://localhost:1313/tags/gradle">Gradle</a>
      </li>
      
      <li class="tag-build config">
        <a href="http://localhost:1313/tags/build-config">build config</a>
      </li>
      
    </ul>
    
  </div>

  
  

  
</div>

  <p>This is first part in series of articles about Android build configuration, all parts will be linked right below.</p>
<blockquote>
<p><strong>[#1 Build basics]({% post_url 2018-07-23-android-build-hacks %})</strong><br>
<strong>[#2 Build time optimization]({% post_url 2018-09-16-android-build-hacks-2 %})</strong></p>
</blockquote>
<h2 id="build-configuration">Build configuration!</h2>
<p>This is not the most exciting part of software engineering. Each technology, language, framework has it&rsquo;s own rules so there are no universal patterns, <a href="https://en.wikipedia.org/wiki/Robert_C._Martin" target="_blank">Uncle Bob</a> will not help us here. But just like this worker on left, tightening the screw of <a href="https://en.wikipedia.org/wiki/Empire_State_Building" target="_blank">Empire State Building</a> skeleton, developers should polish their builds - build config itself is not the application (like skeleton is not the building), but application is useless if you cannot build release version. It also sucks if you have to wait minutes until build is finished, or manually change config for releases.</p>
<p>In Android Studio you start new project, type app name and select minimum SDK and Android Studio generates some files that you don&rsquo;t event want to touch.
But you should. The more complex app you are working on, bigger benefits you may get. Starting from faster builds, through work automation, to easer development and releasing process.</p>
<h2 id="types-and-flavors">Types and Flavors</h2>
<p>After we create new project we already have 2 build variants to select: <code>debug</code> and <code>release</code>. Even if only second one is mentioned in <code>build.gradle</code> file in <code>buildTypes</code> section.
We can easily edit or add more <code>build types</code> and <code>product flavors</code>, creating way too many build variants we need. Each build type is by default combined with each product flavor, and product flavors are combined if they are defined for different dimensions.</p>
<p>Above build types and product flavors your config should also have <code>defaultConfig</code> - just to avoid repeating yourself in build types or flavors.</p>
<p>{% gist 7d82b6a888bde3c753f564c3a0d2c2e8 %}</p>
<p>But what are build types and product flavors even for?</p>
<h3 id="build-types">Build Types</h3>
<p><strong>The same app, different builds</strong></p>
<p>If you want to build exactly the same app (same look, same features etc.) but sometimes you need to <code>debug</code> it, sometimes you want to build <code>release</code>, sometimes you want different signing configuration, switched on/of Proguard and Crashlytics  - separate those variants with <code>build types</code>.</p>
<p>Build types can kinda <em>inherit</em> from each other, for example: you have <code>release</code> build type and want to have <code>alpha</code> build that is exactly the same BUT with different app name. No need to copy-paste whole config:</p>
<p>{% gist 62aea4a659497c2e78e3824cbea70b15 %}</p>
<h3 id="product-flavors">Product Flavors</h3>
<p><strong>The same build, different app</strong> - like bubble gum, same process of creating product, but you can have many flavors (mint, fruit etc.)</p>
<p>If your business model requires <em>free, demo, premium</em> app variants, you need apps in different color schemes, you want to build <code>release</code> app but talking with staging server (bit debatable - it could be also a build type but IMO if it talks with different server, its a different app), you want to build the same app but with different IAP (in app purchases) for different app shops, or you build your app with different features for specific client - use <code>product flavors</code> for separating those variants.</p>
<p>Product flavors are scoped with <code>flavorDimensions</code>. Each flavor needs to be in one dimension, flavors from same dimension are excluding each other from build variant. For example:</p>
<p>{% gist 8608ab5d6165a92c904eabc7c0ee4132 %}</p>
<p>Above configuration will give us variants: devOtherDebug, prodOtherDebug, devOther2Debug, prodOther2Debug - and the same for <code>release</code> build type, but you wont see <strong>devProdDebug</strong> or <strong>devOtherOther2Debug</strong>.</p>
<p>Please notice that <code>build type</code> name comes always on the end - order of names is important. It is similar to CSS, each dimension added to variant overrides previous settings with it&rsquo;s own, and then build type sets them on the end. Just remember this mechanism only overrides settings, it does not clear them.</p>
<p>If you have no idea what is <code>build variant</code>, its this thing you select here:
<img src="assets/posts/android-build-hacks/buildVariants.png" alt="build variants window in Android Studio">{: .center-image }</p>
<p>More info about build types and product flavors can be found at <a href="https://stackoverflow.com/questions/27905934/why-are-build-types-distinct-from-product-flavors" target="_blank">this StackOverflow post</a></p>
<h3 id="dealing-with-flavor-hell">Dealing with Flavor Hell</h3>
<p>So if you enthusiastically started adding flavors and build types to your config you should notice one thing: number of build variants grows at a geometric rate. Each new flavor in existing dimension adds number of build types to build variants, each new dimension doubles number of build variants. And it&rsquo;s really hard to find this one variant you need to build fast in this jungle.</p>
<p>Reducing number of dimensions or flavors is not really a solution if they were created according to business needs - if they are not you may consider rethinking this whole division.
What you should do is ask yourself a question: do I really need ALL of those build variants? If you are releasing Alpha build from your CI server, you don&rsquo;t really need <code>dev</code> flavor. Also <code>dev</code> flavor (will be explained later) makes sense only with <code>debug</code> build.</p>
<p>There are many cases that cause certain build variants to be pointless, so lets filter them out!</p>
<p>{% gist 1b2ccce9f4eaaf752b95188581e49f1e %}</p>
<p>Using simple <code>if</code> statement that checks variant build type and flavors we can set them to be ignored. Take a note that <code>variant.getFlavors()</code> returns list of flavors added by <code>dimension</code> order, that&rsquo;s why I&rsquo;ve used <code>get(0)</code> to get first dimension flavor - <code>stage</code> in my case.</p>
<h2 id="build-settings">Build settings</h2>
<p>Ok we have build types and product flavors, we&rsquo;ve filtered out pointless variants but what can we actually set?
<a href="https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.BuildType.html" target="_blank">Official BuildType documentation</a> mentions whole a lot of properties and methods that can be used for each build type. There&rsquo;s even more in <a href="https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ProductFlavor.html" target="_blank">Official ProductFlavor documentation</a>, but there are also many in common, so remember that build type will override those set in flavor.
Oh also here is <a href="https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.DefaultConfig.html" target="_blank">Official DefaultConfig documentation</a>, because some properties are available only here, nobody said it will be easy.</p>
<p>I won&rsquo;t be going through all of above mentioned properties and methods, I&rsquo;ll just show what can be done with some of them.</p>
<h3 id="applicationid">applicationId</h3>
<p>This one is pretty important. By <code>applicationId</code> your app is recognized in Google Play Store and on Android device. You cannot have 2 different apps with same <code>appliationId</code> on the same device or in Google Play Store - even from different accounts. You may have noticed that if you have your app installed from Google Play (official release) and want to install <code>debug</code> version from Android Studio it will ask to remove Google Play app - yes it&rsquo;s because different signing (with Android debug key) and even debug version installed from one machine will need to be erased if you install it from other machine. But because both apps have same <code>applicationId</code> Android will know it&rsquo;s the same app. And if we want to keep our released and configured app on our device and have <code>debug</code> build installed next to it?</p>
<p>Well we need to change <code>applicationId</code> of <code>debug</code> build type of course!
If you&rsquo;ve looked through documentation you may have noticed that there is no way to change <code>applicationId</code> in build type config, it&rsquo;s set only in <code>defaultConfig</code> (and product flavors). But there is property <code>applicationIdSuffix</code> - it will add text to our <code>applicationId</code>. You can set it like:</p>
<p>{% gist 37f95a28d4b837baa608e6537e591d34 %}</p>
<p>Keep official release of your app and install debug just next to it.</p>
<h3 id="buildconfigfield">buildConfigField</h3>
<p>During build process a static <code>BuildConfig</code> class is created. This class contains fields like <code>APPLICATION_ID</code>, <code>VERSION_CODE</code>, <code>VERSION_NAME</code> and others taken from - you&rsquo;ve guest it - build config. Those fields are easily accessible in app, and are often used to modify it&rsquo;s behavior like turning off Google Analytics if app is in debug mode. We can add custom fields to this class in both build types and product flavors. Method takes 3 String arguments - type, name and value.</p>
<p>{% gist b88e04711e62d335f429a344aaac993e %}</p>
<p>Those custom fields type can be <code>String</code>, <code>boolean</code>, <code>int</code>, <code>long</code>, <code>float</code> and <code>double</code>. If you set the same field in flavor and build type, it will be overridden with build type value.</p>
<h3 id="resvalue">resValue</h3>
<p>Setting custom <code>BuildConfig</code> field is cool, but it is also possible to <strong>add</strong> resource value. If you try to set a value that already exists in resources, you will get <code>Error: Duplicate resources</code> during build. Method looks similar to <code>buildConfigField</code></p>
<p>{% gist 0b91b53cc2dc3d374d251ad2c7708089 %}</p>
<p>Types are diferent thant for <code>buildConfigField</code> and you can use: <code>array, attr, bool, color, declare-styleable, dimen, fraction, id, integer, plurals, string, style</code> but most common will be <code>string, bool, dimen, integer</code> I guess</p>
<h3 id="manifestplaceholders">manifestPlaceholders</h3>
<p>There is one last place where we might want to set things according to our build variant - the manifest. Sometimes in manifest you need to add API key to some services used by libraries like Fabric, you may want to have a different keys for different build variants and this is a clean solution - no more checking <code>BuildConfig</code> and setting stuff in huge <code>switch</code> statement. I like to use <code>manifestPlaceholders</code> to set app name - for release builds (or by default) it is taken from resources because it may vary in different languages, but for debug build&hellip; I don&rsquo;t care so much about languages, I just want to know that it is debug build. It can be also achieved by creating <code>src/{buildTypeName | productFlavorName}</code> directory and adding <code>string.xml</code> with app name string there for each build type or flavor we want to switch app name&hellip; but if you don&rsquo;t change a lot of resources in build variants keeping changes in build config looks cleaner.
{% gist 0c74f1af1a421f2483c8b24802e807ae %}
and in <code>AndroidManifest.xml</code></p>
<pre tabindex="0"><code>  android:label=&#34;${appName}&#34;
</code></pre><p>There is also more complex usage of <code>manifestPlaceholders</code> and <code>buildConfigField</code> at <a href="https://developer.android.com/studio/build/gradle-tips#share-properties-with-the-manifest" target="_blank">Android docs</a> that might be useful.</p>
<h3 id="versionnamesuffix">versionNameSuffix</h3>
<p>Ever been an app beta tester? So you might seen version names like <code>1.2.3-build-1223123-RC</code> in system application settings. It can be added by using <code>versionNameSuffix</code> property in both product flavors and build types. Of course build number should be generated automatically, but this will be done in some future post.</p>
<p>{% gist 4b30b3b0f32e444229de650394dd5b3b %}</p>
<h3 id="resconfigs">resConfigs</h3>
<p>Sometimes you add new language to your app and you need to test how bad your layouts will look with it. No need to change your device language - it&rsquo;s a pain if you don&rsquo;t know new language enough to go back to your native one&hellip; just force build variant to use specific resources:</p>
<p>{% gist 0bdf3e0ffb2fe3f28eb8aaeff5fe7ea4 %}</p>
<p>You can specify list of all possible resource configurations including screen density - but it won&rsquo;t allow you do to it if you use APK density split.
Also it shouldn&rsquo;t be used with build type <code>pseudoLocalesEnabled</code> property.</p>
<h2 id="splits">Splits</h2>
<p>Let&rsquo;s say you have an app with lots of images (not SVG) in few screen densities so app looks good on every device. But you build single APK for all densities, so each user needs to download app with way more resources than will ever be used. Splits are here to save the day. It allows Gradle to generate multiple APK files of the same build variant but with single resources for density, language or ABI (Application Binary Interface). Google Play just sends fitting APK to user that want to download your app.</p>
<p>{% gist ea7a74124edf1c3881e6475f0a683bb3 %}</p>
<p>Above code will cause generation of 16 (5 densities * 3 ABI + universal APK) APK files, fitting exactly users device specs. More bitmap graphics your app uses, bigger gains in APK size will you get.</p>
<p>In split config we have to specify if it&rsquo;s enabled, and then we use <code>reset()</code> to clear default density or ABI list. Then we can <code>include</code> array of values (ABI or densities) - or if you don&rsquo;t want to reset default one you can just <code>exclude</code> some with array of unwanted values. <code>universalApk</code> takes boolean argument and in my case it&rsquo;s generated for release build only, it contains all of resources and is compatible with all ABI - this file will be size of your app without using splits.</p>
<p>I don&rsquo;t really see a point in using language split since <code>strings.xml</code> are lightweight files, but it&rsquo;s also possible. Also ABI split may be just overcomplicating your build process.</p>
<p>It&rsquo;s worth mentioning that for each APK you want to release you need to generate different <code>versionCode</code> or Google Play wont allow you to send it.</p>
<p>{% gist a0120bc0cf1e02a1a8ac4aba67714a60 %}</p>
<p>In above code I check for which ABI and density variant is being build, multiply position of variant ABI in <code>abiList</code> by 10 and add this number and variant density position in <code>densityList</code> to version code for current build. Example: default version code is <strong>1230000</strong> (needs to be &lt; 2 100 000 000) and current split variant is <strong>x86 xxhdpi</strong>, so we have 1230000 + 30 + 4 = <strong>1230034</strong>.</p>
<h2 id="end-of-part-1">End of part #1</h2>
<p>It&rsquo;s top of an iceberg but I&rsquo;ve tried to explain main building blocks of Android build configuration. In upcoming posts I&rsquo;ll show some build time optimizations and useful scripts to generate values used in builds. Below you can find links to documentation or blogposts that might extend this topic furthermore.</p>
<h2 id="useful-links">Useful links</h2>
<ul>
<li><a href="https://developer.android.com/studio/build/build-variants" target="_blank">Build Variants docs</a></li>
<li><a href="https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.DefaultConfig.html" target="_blank">DefaultConfig docs</a></li>
<li><a href="https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.BuildType.html" target="_blank">BuildType docs</a></li>
<li><a href="https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ProductFlavor.html" target="_blank">ProductFlavor docs</a></li>
<li><a href="https://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.Splits.html" target="_blank">Splits dos</a></li>
<li><a href="https://www.androidauthority.com/building-multiple-flavors-android-app-706436/" target="_blank">Android Authority post about flavors by Obaro Ogbo</a></li>
<li><a href="https://medium.com/@thiagolopessilva/the-handling-multiple-java-source-and-resources-using-flavors-on-gradle-18a4b581285b" target="_blank">Medium post about flavors by Thiago Lopes Silva</a></li>
<li><a href="http://onebigfunction.com/android/2016/10/06/flavor-flav-android-product-flavors-explained/" target="_blank">Another post about flavors</a></li>
</ul>

  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="http://localhost:1313/android-frida-hacking/?ref=footer"><span style="font-weight:bold;">« Previous</span><br>Hacking Android app with Frida</a>
        
	    
            <div class="next-post">
                <a href="http://localhost:1313/android-build-hacks-2/?ref=footer"><span style="font-weight:bold;">Next »</span><br>Android Build Hacks #2 - build time optimization</a>
            </div>
        
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#build-configuration">Build configuration!</a></li>
    <li><a href="#types-and-flavors">Types and Flavors</a>
      <ul>
        <li><a href="#build-types">Build Types</a></li>
        <li><a href="#product-flavors">Product Flavors</a></li>
        <li><a href="#dealing-with-flavor-hell">Dealing with Flavor Hell</a></li>
      </ul>
    </li>
    <li><a href="#build-settings">Build settings</a>
      <ul>
        <li><a href="#applicationid">applicationId</a></li>
        <li><a href="#buildconfigfield">buildConfigField</a></li>
        <li><a href="#resvalue">resValue</a></li>
        <li><a href="#manifestplaceholders">manifestPlaceholders</a></li>
        <li><a href="#versionnamesuffix">versionNameSuffix</a></li>
        <li><a href="#resconfigs">resConfigs</a></li>
      </ul>
    </li>
    <li><a href="#splits">Splits</a></li>
    <li><a href="#end-of-part-1">End of part #1</a></li>
    <li><a href="#useful-links">Useful links</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>
