<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.91ae35f985ba4ae6473b8defee39551f3ce6ed2769fdfa9b3df93f2eac0da4bc.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/assets/favicon.ico>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Adam Świderski - Command Pattern in Kotlin</title>
<meta property="og:title" content=Adam&#32;Świderski&#32;-&#32;Command&#32;Pattern&#32;in&#32;Kotlin />
<meta name="twitter:title" content=Adam&#32;Świderski&#32;-&#32;Command&#32;Pattern&#32;in&#32;Kotlin />
<meta itemprop="name" content=Adam&#32;Świderski&#32;-&#32;Command&#32;Pattern&#32;in&#32;Kotlin />
<meta name="application-name" content=Adam&#32;Świderski&#32;-&#32;Command&#32;Pattern&#32;in&#32;Kotlin />
<meta property="og:site_name" content="Adam Coding Corner" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="//localhost:1313/kotlin-command-pattern/" />
<link rel="canonical" href="//localhost:1313/kotlin-command-pattern/" itemprop="url" />
<meta name="url" content="//localhost:1313/kotlin-command-pattern/" />
<meta name="twitter:url" content="//localhost:1313/kotlin-command-pattern/" />
<meta property="og:url" content="//localhost:1313/kotlin-command-pattern/" />


<meta property="og:updated_time" content=22008-22-12T80:00:21Z />


<link rel="sitemap" type="application/xml" title="Sitemap" href='//localhost:1313/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />


<meta name="twitter:site" content="" />
<meta name="twitter:creator" content="" />
<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Adam Coding Corner" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />





<meta property="og:type" content="article" />
<meta property="article:publisher" content="" />
<meta property="og:article:published_time" content=22008-22-12T80:00:21Z />
<meta property="article:published_time" content=22008-22-12T80:00:21Z />








<meta name="generator" content="Hugo 0.123.7">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.684be08038c8e02f27eed57328c70b4a2b8156ece14b38d3a7c0d860ea16edb9.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #bebebe;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="//localhost:1313/">
                <img src="/assets/profile_picture.png" alt="brand image">
            </a>
        
        
            <a href="//localhost:1313/">
                <h1>Adam Świderski</h1>
            </a>
        
    </h1>
    <p class="lead">
    software engineer
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">
        
        
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/about/">About</a>
                    </li>
                    
                
            
                
                
            
                
                
            
            
                
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="/posts/">Posts</a>
                    </li>
                    
                        <li class="sub-heading">
                            Recent
                        </li>
                        
                            <li class="bullet">
                                <a href="//localhost:1313/2024-02-24-MVI/">Android Presentation Patterns: MVI</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="//localhost:1313/2024-02-09-MVVM/">Android Presentation Patterns: MVVM</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="//localhost:1313/2024-01-29-MVP/">Android Presentation Patterns: MVP</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="//localhost:1313/2024-01-27-MVC/">Android Presentation Patterns: MVC</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="//localhost:1313/2023-06-16-ci-is-your-friend/">Continuous Integration and Deployment: A Developer&#39;s Best Friends</a>
                            </li>
                        
                    
                
            
                
                
            
            
                
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://linkedin.com">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>






    <a target="_blank" class="social" title="YouTube" href="https://youtube.com">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12.006 19.012h-.02c-.062 0-6.265-.012-7.83-.437a2.5 2.5 0 0 1-1.764-1.765A26.494 26.494 0 0 1 1.986 12a26.646 26.646 0 0 1 .417-4.817A2.564 2.564 0 0 1 4.169 5.4c1.522-.4 7.554-.4 7.81-.4H12c.063 0 6.282.012 7.831.437c.859.233 1.53.904 1.762 1.763c.29 1.594.427 3.211.407 4.831a26.568 26.568 0 0 1-.418 4.811a2.51 2.51 0 0 1-1.767 1.763c-1.52.403-7.553.407-7.809.407Zm-2-10.007l-.005 6l5.212-3l-5.207-3Z"/>
        </svg>
    </a>








    <a target="_blank" class="social" title="RSS Feed" href="/posts/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>


    <a target="_blank" class="social" title="Email" href="mailto://user@domain">
       <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211">
            <path fill="currentColor" d="M301.393,241.631L464.866,424.56H20.332l163.474-182.928l58.801,51.443L301.393,241.631z M462.174,60.651H23.027 l219.579,192.142L462.174,60.651z M324.225,221.67l160.986,180.151V80.792L324.225,221.67z M0,80.792v321.029L160.972,221.64 L0,80.792z"/>
       </svg>
    </a>


        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 Adam Coding Corner. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="//localhost:1313/kotlin-command-pattern/">Command Pattern in Kotlin</a>
  </h1>

  <div class="headline">
    <div>
      
      <time datetime=" 2021-08-22T00:00:00Z" class="post-date">
        August 22, 2021
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>15 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-kotlin">
        <a href="//localhost:1313/tags/kotlin">kotlin</a>
      </li>
      
      <li class="tag-Command Pattern">
        <a href="//localhost:1313/tags/command-pattern">Command Pattern</a>
      </li>
      
      <li class="tag-design patterns">
        <a href="//localhost:1313/tags/design-patterns">design patterns</a>
      </li>
      
    </ul>
    
  </div>

  
  
  <p class="seriesname">
    Series: <a href="//localhost:1313/series/kotlin-design-patterns">Kotlin Design Patterns</a>
  </p>
  

  
</div>

  <h1 id="purpose">Purpose</h1>
<p>The Command pattern wraps the request into a specific object that has all the information necessary to perform its task. You can think of it as the next stage of refactoring, where at first we extract the code to a separate method, and then to a separate object, taking the arguments needed to execute the request in the constructor.</p>
<p>Since the request is an object, it can be sent to a separate object (<code>CommandProcessor</code>) for execution, which allows for their queuing and facilitates logging events. The same command can be used in different places in the system, encapsulating the entire logic of the request execution, which prevents code duplication. It does not have to be the same instance, but the class.</p>
<p>The request object, in addition to the standard <code>execute()</code> method, may contain a method like <code>undo()</code>, i.e. undoing the changes made by the request. Virtually all graphics programs or word processors have this option. They could be storing each change in the form of <code>Command</code> in some buffer with limited capacity (hence the possibility of e.g. only 3 undos), and if the user wants to undo the last change made, the<code>Command</code> is pulled from the buffer and the changes made by it are undone.</p>
<h1 id="implementation">Implementation</h1>
<h2 id="abstract">Abstract</h2>
<p>As already mentioned, by default the <code>Command</code> object has an <code>execute()</code> (or equivalent) method. There are several other classes in this pattern:</p>
<ul>
<li><strong>Receiver</strong> - object used by the <code>Command</code> to complete its task. If the <code>Command</code> is to download the weather from the internet,<code> Receiver</code> will be an HTTP client, for example. It can be any class in your system.</li>
<li><strong>Invoker</strong> - the class using the <code>Command</code></li>
<li><strong>Client</strong> - creates the <code>ConcreteCommand</code> instance and binds it with the <code>Receiver</code> and sets it in the<code>Invoker</code></li>
<li><strong>ConcreteCommand</strong> - specific command. It has all the other objects needed to complete the task.</li>
</ul>
<pre class="mermaid" style="background-color: #FAF9F6 !important;">classDiagram
    class Command {
         << interface >>
        +execute()
    }

    class ConcreteCommand {
        -receiver: Receiver
        -params
        +execute()
    }

    class Receiver {
        +action()
    }

    class Client
    class Invoker {
        -command: Command
        +setCommand(command)
        +executeCommand()
    }

    Invoker --> Command
    Client --> Receiver
    ConcreteCommand --> Receiver:action()

    note for Invoker "calls command when it's needed"

    Client .. ConcreteCommand: creates command instance\npassing the Receiver\nand command parameters
    Client .. Invoker: sets command instance
</pre>
<p>The order of interactions looks like this:</p>
<pre class="mermaid" style="background-color: #FAF9F6 !important;">sequenceDiagram
    participant aClient
    participant aReceiver
    participant aCommand
    participant aInvoker

    aClient -->> aReceiver : has a
    aClient -->> aCommand : Command(aReceiver)
    activate aClient
    aClient ->> aInvoker : setCommand(aCommand)
    deactivate aClient
    aInvoker ->> aCommand : execute()
    aCommand ->> aReceiver : action()
</pre>
<ol>
<li>The <code>Client</code> creates the instance of the specific <code>Command</code>, passing the receiver <code>Receiver</code>.</li>
<li><code>Invoker</code> gets a specific instance of the command.</li>
<li>The <code>Invoker</code> uses the <code>execute()</code> method of the command instance to do its own thing. For example, this could be to perform an action &ldquo;on click&rdquo; if <code>Invoker</code> is a UI button.</li>
<li>The <code>Command</code> calls the appropriate methods of its <code>Receiver</code>.</li>
</ol>
<p>In such generic form it can be implemented like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// generic Command interface
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// binding the Receiver class in the generic interface allows grouping commands in a way
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// e.g. related to text editing, graphic editor or HTTP requests
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// it&#39;s not required by the pattern itself
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Command</span>(<span style="color:#66d9ef">val</span> receiver: Receiver) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// concrete Command taking Refceiver in the constructor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConcreteCommand</span>(<span style="color:#66d9ef">receiver</span>: Receiver) : Command(<span style="color:#66d9ef">receiver</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;executing ConcreteCommand&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// calling action on Recveiver to perform a task
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">receiver</span>.action()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// the &#34;true&#34; action performer, knowing implementation details
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// e.g. text editor or HTTP client
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Receiver</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">action</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;performing action in Receiver&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// class using the passed Command
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// e.g. UI button calling Command when clicked
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Invoker</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> aCommand: Command
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">setCommand</span>(command: Command) {
</span></span><span style="display:flex;"><span>        aCommand = command
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">performAction</span>() {
</span></span><span style="display:flex;"><span>        aCommand.execute()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// class connecting Receiver, Command and Invoker
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Client</span>(invoker: Invoker) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> receiver = Receiver()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">init</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// setting the Invoker command
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> concreteCommand = ConcreteCommand(<span style="color:#66d9ef">receiver</span>)
</span></span><span style="display:flex;"><span>        invoker.setCommand(concreteCommand)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> invoker = Invoker()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Client(invoker)
</span></span><span style="display:flex;"><span>    invoker.performAction()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="return-result">Return Result</h3>
<p>The command may return some value. However, this will not always be a good practice. While returning <code>Success/Failure</code> will usually be OK to inform the calling class about the command execution status, returning some specific data will conflict with the <code>CQRS</code> - command query responsibility segregation approach. The point is that the command either changes something or returns data.</p>
<p>Let&rsquo;s take this situation: you display a list of names, each list item can be edited and the name is changed. A name change is encapsulated in a command that operates on some data repository. Should such command return anything, and if so, what exactly? The whole list of names with the updated name? What if list is paged, do you return just the page with the updated item, or whole list of items up to this item? Or should the command return the changed name itself, so then <code>Invoker</code> has to update the displayed list. But then you have 2 representations of the names list: one in the repository and second one in the view, even if values are the same (but there is nothing to guarantee this).
It&rsquo;s better if the command returns simple <code>Success</code>, which will cause the view to download the current list of names from the repository or show errors message. Or better yet, if the view always keeps its list up-to-date with repository by some sort of <code>data-binding</code> or <code>Observer</code>. After executing the command, the list will update itself, and you don&rsquo;t even need to return any <code>Success/Failure</code> from the command, unless you need to handle the error.</p>
<p>Another way may be to pass some callback in the <code>execute()</code>, but maybe let&rsquo;s not go that way :)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// command result nicely fits with `sealed class`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CommandResult</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// returned values could be `object` if they don&#39;t contain any data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Success</span> : CommandResult()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Fail</span> : CommandResult()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// `interface` instead of `abstract class` this time, no forced `Receiver` type in the constructor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Command</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>(): CommandResult
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// `Receiver` appears just here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConcreteCommand</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> receiver: Receiver) : Command {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// executing the command returns a result
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>(): CommandResult {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;executing ConcreteCommand&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// that depends on Receiver response
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">receiver</span>.action()) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">CommandResult</span>.Success()
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">CommandResult</span>.Fail()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// `Receiver` that returns random Boolean
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Receiver</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">action</span>(): Boolean {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;performing action in Receiver&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Random</span>.nextBoolean()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> receiver = Receiver()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// no `Invoker` in this example, invoking is simply in `main()`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> result = ConcreteCommand(<span style="color:#66d9ef">receiver</span>).execute()
</span></span><span style="display:flex;"><span>    println(<span style="color:#e6db74">&#34;Command result is: </span><span style="color:#e6db74">$result</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="commandprocessor">CommandProcessor</h3>
<p>Closing the entire command in an object allows it to be passed to the external <code>Processor</code> instead of being executed immediately. The <code>Processor</code> can queue and execute commands according to its internal logic, but from the <code>Invoker</code> point of view, it doesn&rsquo;t really matter. The <code>Receiver</code> can be moved from a command to the <code>Processor</code>, thus the commands will only take its parameters, and the rest will be handled by <code>Processor</code> when calling the <code>execute()</code>.</p>
<p>However, make sure that the <code>execute()</code> method always has the same signature, and you do not have to implement special handling inside the <code>Processor</code> due to the type of the command. As long as <code>Command</code> and <code>Processor</code> are in the same domain (e.g. HTTP requests to a specific API, sending messages via Bluetooth), there should be no problems with that. If a given <code>Processor</code> needs to pass different <code>Receiver</code> type when executing commands, it may suggest that they should go to a different <code>Processor</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// util to generate random delays in suspended methods
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">randomDelay</span>() = <span style="color:#a6e22e">Random</span>.nextLong(<span style="color:#ae81ff">1000</span>, <span style="color:#ae81ff">3000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Command</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Receiver is passed at the execute() call, not sooner
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">suspend</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>(<span style="color:#66d9ef">receiver</span>: Receiver)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// commands take only parameters, without Receiver
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FirstCommand</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> param: Int) : Command {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">suspend</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>(<span style="color:#66d9ef">receiver</span>: Receiver) {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;executing FirstCommand </span><span style="color:#e6db74">$param</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">receiver</span>.action()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecondCommand</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> param: String) : Command {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">suspend</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>(<span style="color:#66d9ef">receiver</span>: Receiver) {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;executing SecondCommand </span><span style="color:#e6db74">$param</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">receiver</span>.action()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Receiver</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// running Receivers action may take a while, thus `suspend` and `delay()` to mimic that
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">suspend</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">action</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;performing action in Receiver&#34;</span>)
</span></span><span style="display:flex;"><span>        delay(randomDelay())
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;action finished!&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// the most important class in this example
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// it has the Receiver instance used by the commands
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// commands are stored in FIFO queue in the form of `Channel`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">CommandProcessor</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> commands = Channel&lt;Command&gt;()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// using separate Scopes for adding and executing commands solves blocking one by another
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> processScope = CoroutineScope(<span style="color:#a6e22e">Executors</span>.newSingleThreadExecutor().asCoroutineDispatcher())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> executeScope = CoroutineScope(<span style="color:#a6e22e">Executors</span>.newSingleThreadExecutor().asCoroutineDispatcher())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> receiver = Receiver()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">process</span>(command: Command) {
</span></span><span style="display:flex;"><span>        processScope.launch {
</span></span><span style="display:flex;"><span>            println(<span style="color:#e6db74">&#34;adding </span><span style="color:#e6db74">$command</span><span style="color:#e6db74"> to the queue&#34;</span>)
</span></span><span style="display:flex;"><span>            commands.send(command)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">init</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// waiting for new commands in the queue and executing them as soon as they come
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        executeScope.launch {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (command <span style="color:#66d9ef">in</span> commands) {
</span></span><span style="display:flex;"><span>                command.execute(<span style="color:#66d9ef">receiver</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Invoker without changes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Invoker</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> aCommand: Command
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">setCommand</span>(command: Command) {
</span></span><span style="display:flex;"><span>        aCommand = command
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">performAction</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">CommandProcessor</span>.process(aCommand)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> firstInvoker = Invoker()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> secondInvoker = Invoker()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// no Receiver here, just command parameters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    firstInvoker.setCommand(FirstCommand(<span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>    secondInvoker.setCommand(SecondCommand(<span style="color:#e6db74">&#34;2&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// invoking actions 10x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    repeat(<span style="color:#ae81ff">10</span>) {
</span></span><span style="display:flex;"><span>        firstInvoker.performAction()
</span></span><span style="display:flex;"><span>        secondInvoker.performAction()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <code>CommandProcessor</code> is an object that processes commands sent to it. Adding new commands does not block their execution because it runs in separate scope. In this case, commands that return nothing will work best. You just throw them on the queue, and the command effect (if needed) should come through a different channel, as in a proper <code>CQRS</code>. Queue and thread management is on the <code>Processor</code> side, the <code>Invoker</code> doesn&rsquo;t have to deal with it, or even know if there are <code>coroutines</code>, Java threads or some <code>RX</code>. Commands are executed sequentially, one after the other. Combined with <code>delay()</code> for the Receiver action, this has the effect of immediately adding commands to the queue, and laboriously executing them.</p>
<p>Queue commands execution can also be done in parallel with multiple <code>launchProcessors</code> taking <code>Channel</code> as parameter:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// IRL this would be provided by DI, but for the sake of example `object` will do
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">CommandProcessor</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// no changes here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> commands = Channel&lt;Command&gt;()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> processScope = CoroutineScope(<span style="color:#a6e22e">Executors</span>.newSingleThreadExecutor().asCoroutineDispatcher())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> executeScope = CoroutineScope(<span style="color:#a6e22e">Executors</span>.newSingleThreadExecutor().asCoroutineDispatcher())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> receiver = Receiver()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">process</span>(command: Command) {
</span></span><span style="display:flex;"><span>        processScope.launch {
</span></span><span style="display:flex;"><span>            delay(randomDelay())
</span></span><span style="display:flex;"><span>            println(<span style="color:#e6db74">&#34;adding </span><span style="color:#e6db74">$command</span><span style="color:#e6db74"> to the queue&#34;</span>)
</span></span><span style="display:flex;"><span>            commands.send(command)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">init</span> {
</span></span><span style="display:flex;"><span>        executeScope.launch {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// starting 5 internal command processors, working on the same queue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">// so there can be 5 commands executed at the same time
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            repeat(<span style="color:#ae81ff">5</span>) {
</span></span><span style="display:flex;"><span>                launchProcessor(commands)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// private `extension function` that alows multiple consumers take commands from the same queue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// each command is executed only once
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// after execution is done, the processor is taking next item from the queue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">CoroutineScope</span>.launchProcessor(channel: ReceiveChannel&lt;Command&gt;) = launch {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (command <span style="color:#66d9ef">in</span> channel) {
</span></span><span style="display:flex;"><span>            command.execute(<span style="color:#66d9ef">receiver</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>But this will also mean that i.e. if <code>Command 1</code> takes longer to execute than <code>Command 2</code>, the latter will be finished sooner which may not always be a good thing. It depends heavily on the case.</p>
<h3 id="undo">Undo</h3>
<p>Commands may have a method that allows undoing the changes they have made, i.e. <code>undo()</code> known from graphic or text editors. The implementation will strongly depend on the case, but it can be assumed that the command remembers the state before the change and restores it, if necessary. Holding multiple states in history eats memory and therefore the history buffer is often limited to the last 3 commands (or similar). Undo execution of a command can also be achieved by executing a command with the opposite parameters, then there is no need to hold the state, and the execution of <code>undo()</code> itself can be saved in the history. Undoed commands may end up in a separate buffer, allowing them to be executed again with <code>redo()</code>.</p>
<p>Strongly simplified example of <code>undo()</code> with keeping the before-execution state:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// generic command of drawing &#34;something&#34; on the `Canvas`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DrawCommand</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> canvas: Canvas) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// state before executing command - the list of already drawn elements
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> preCommandState = listOf&lt;Shape&gt;()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// saving the state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">saveState</span>() {
</span></span><span style="display:flex;"><span>        preCommandState = canvas.shapes.toList()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// undoing the command, so setting Canvas state from before exectuion
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">undo</span>() {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;undo </span><span style="color:#e6db74">${this}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        canvas.shapes = preCommandState.toMutableList()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// drawable shapes interfaces
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Shape</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">data</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Line</span>(<span style="color:#66d9ef">val</span> length: Int) : Shape
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">data</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Circle</span>(<span style="color:#66d9ef">val</span> diameter: Int) : Shape
</span></span><span style="display:flex;"><span><span style="color:#75715e">// commands for drawing shapes, taking params and Receiver (Canvas)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DrawLine</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> length: Int, <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> canvas: Canvas) : DrawCommand(canvas) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>() {
</span></span><span style="display:flex;"><span>        saveState()
</span></span><span style="display:flex;"><span>        canvas.draw(Line(length))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DrawCircle</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> diameter: Int, <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> canvas: Canvas) : DrawCommand(canvas) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>() {
</span></span><span style="display:flex;"><span>        saveState()
</span></span><span style="display:flex;"><span>        canvas.draw(Circle(diameter))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Receiver
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Canvas</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// current canvas state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> shapes: MutableList&lt;Shape&gt; = mutableListOf()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// drawing a shape on Canvas means adding it to the list of shapes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">draw</span>(shape: Shape) {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;drawing a </span><span style="color:#e6db74">$shape</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        shapes.add(shape)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> canvas = Canvas()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> commandsHistory = mutableListOf&lt;DrawCommand&gt;()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// after executing the command its being preserved in history
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> drawLine = DrawLine(<span style="color:#ae81ff">2</span>, canvas)
</span></span><span style="display:flex;"><span>    drawLine.execute()
</span></span><span style="display:flex;"><span>    commandsHistory.add(drawLine)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> drawCircle = DrawCircle(<span style="color:#ae81ff">1</span>, canvas)
</span></span><span style="display:flex;"><span>    drawCircle.execute()
</span></span><span style="display:flex;"><span>    commandsHistory.add(drawCircle)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> drawLongLine = DrawLine(<span style="color:#ae81ff">10</span>, canvas)
</span></span><span style="display:flex;"><span>    drawLongLine.execute()
</span></span><span style="display:flex;"><span>    commandsHistory.add(drawLongLine)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> drawBigCircle = DrawCircle(<span style="color:#ae81ff">12</span>, canvas)
</span></span><span style="display:flex;"><span>    drawBigCircle.execute()
</span></span><span style="display:flex;"><span>    commandsHistory.add(drawBigCircle)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    println(<span style="color:#e6db74">&#34;current shapes: </span><span style="color:#e6db74">${canvas.shapes}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    println(<span style="color:#e6db74">&#34;--- undo last 2 ---&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// reverting last 2 commands
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    commandsHistory.removeLast().undo()
</span></span><span style="display:flex;"><span>    commandsHistory.removeLast().undo()
</span></span><span style="display:flex;"><span>    println(<span style="color:#e6db74">&#34;current shapes: </span><span style="color:#e6db74">${canvas.shapes}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="why-not-just-use-lambdas">Why not just use lambdas?</h3>
<p>It may seem that creating a whole class and then an object to perform some action is a redundancy, and that the same functionality and readability can be achieved using lambdas.</p>
<p>Example using a similar processor from the previous case:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// command uses Receiver when its executed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> command = { <span style="color:#66d9ef">receiver</span>: Receiver <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;this is a command to do stuff&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">receiver</span>.action()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    repeat(<span style="color:#ae81ff">10</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">CommandProcessor</span>.process(command)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// lambda-commands don&#39;t need to be assigned to variables
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">CommandProcessor</span>.process { <span style="color:#66d9ef">receiver</span>: Receiver <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>            println(<span style="color:#e6db74">&#34;this is a another command&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">receiver</span>.action()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We tell the <code>CommandProcessor</code>: execute this block using your <code>Receiver</code> instance. However, we lose the ability to parameterize command objects. Lambda can take parameters, but they will be used at runtime, which is in the <code>CommandProcessor</code>. Of course, they can be passed in the <code>process ()</code> method, but then it is difficult to talk about command encapsulation if you have a block of code in one place and parameters need to be passed in another.
If the <code>action()</code> method were <code>suspend</code>, it would need to be handled in the lambda block, wrapping the call in some <code>CoroutineScope</code>. It could come from <code>CommandProcessor</code> just like the <code>Receiver</code> but this is another complication that occurs when Lambda is created.</p>
<p>To sum up: if you want to have a parameterized Lambda, passed to the processor and use it in multiple places of the system - <strong>create a class</strong>.</p>
<h2 id="home-automation-example">Home Automation example</h2>
<p>It may be my professional bias, but controlling remote devices is perfect for a real-life example of using the <code>Command</code> pattern.</p>
<p>Lets have some devices that can be turned ON or OFF and a remote control to set these devices. The remote control is not directly connected to any specific device, it can control any of them, or multiple at the same time. The remote is also not aware of the device it&rsquo;s controlling, it just handles pressing its buttons.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// Invoker, takes commands in the constructor, but it could also use setters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RemoteController</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> firstButtonAction: Command,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> secondButtonAction: Command,
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">firstButtonClicked</span>() {
</span></span><span style="display:flex;"><span>        firstButtonAction.execute()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">secondButtonClicked</span>() {
</span></span><span style="display:flex;"><span>        secondButtonAction.execute()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Command</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Receiver
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Device</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> name: String) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">switch</span>(on: Boolean) {
</span></span><span style="display:flex;"><span>        println(<span style="color:#e6db74">&#34;turning device </span><span style="color:#e6db74">$name</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${if (on) &#34;ON&#34; else &#34;OFF&#34;}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// concrete command thaking Receiver in the constructor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TurnOnCommand</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> device: Device) : Command {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// and calling a method according to its task
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        device.switch(<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TurnOffCommand</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> device: Device) : Command {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">execute</span>() {
</span></span><span style="display:flex;"><span>        device.switch(<span style="color:#66d9ef">false</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Receiver instance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> lightBulb = Device(<span style="color:#e6db74">&#34;living room light&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// passed to the commands
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> turnOn: Command = TurnOnCommand(lightBulb)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> turnOff: Command = TurnOffCommand(lightBulb)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Invoker (the remote) gets commands for its buttons
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> remote = RemoteController(turnOn, turnOff)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// but Invoker itself is just executing the commands, has no idea which device its controlling and how
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    remote.firstButtonClicked()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    remote.secondButtonClicked()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="naming">Naming</h1>
<p>Adding the <code>Command</code> suffix to the names of specific commands seems to make sense. It clearly defines what the class is used for. In the case of the <code>Receiver</code> or <code>Invoker</code>, which by nature already have their specific tasks and just found themselves in this pattern kinda &ldquo;by the way&rdquo; would only be confusing. You can see that in the last example of <em>Home Automation</em>.</p>
<h1 id="summary">Summary</h1>
<p>The <code>Command</code> is one of my favorite patterns, most of the time I have used it with some form of <code>CommandProcessor</code>. It perfectly encapsulates the request and allows it to be moved and reused. It facilitates refactoring because it is easy to replace one command with another, or to change the internal implementation without affecting the clients of it.</p>
<p>Command objects can contain a method to undo the changes they made. This is done by keeping the state of the <code>Receiver</code> before executing the command, or by executing the command with opposite parameters. Reverted commands can be put on a separate buffer, which allows them to be redone if necessary.</p>
<h2 id="pros">Pros</h2>
<ul>
<li><strong>encapsulation</strong> - the whole logic and method calls required to perform the task are inside a single object with generic and simple interface. It allows queueing execution, reusing code, simple testing and refactorization.</li>
<li><strong>dynamic behavior change</strong> - passing command objects enables changing behavior of the <code>Invoker</code> in the runtime, i.e. when application config is updated remotely</li>
<li><strong>multiple calls in one</strong> - instead of calling multiple methods of a few <code>Receivers</code>, a single <code>Command</code> can be created that will do all that</li>
<li><strong>undo/redo</strong> - this pattern naturally allows to undo and redo set of instructions</li>
<li><strong>simple extending</strong> - adding new <code>Command</code> doesn&rsquo;t influence previous ones, or the calling <code>Invoker</code></li>
</ul>
<h2 id="cons">Cons</h2>
<ul>
<li><strong>many similar classes</strong> - depending on the situation, using the <code>Command</code> pattern may cause having multiple classes with single line difference</li>
<li><strong>premature complication</strong> - using this pattern too early might end up with single <code>Command</code> class used in one place, but surrounded with additional interfaces, <code>CommandProcessor</code>, etc.</li>
</ul>

  
  <hr>
<div class="footer">
    
    
    
    <p>
    This is a post in the <b><a href="//localhost:1313/series/kotlin-design-patterns">Kotlin Design Patterns</a></b> series.
        <br>Other posts in this series:
        <ul class="series">
            
            
            
            <li>
                August 22, 2021 -
                
                    Command Pattern in Kotlin
                
            </li>
            
            <li>
                July 17, 2021 -
                
                    <a href="/kotlin_mediator_pattern/">Mediator in Kotlin</a>
                
            </li>
            
            <li>
                July 3, 2021 -
                
                    <a href="/kotlin-decorator-pattern/">Decorator Pattern in Kotlin</a>
                
            </li>
            
            <li>
                June 26, 2021 -
                
                    <a href="/kotlin-adapter-pattern/">Adapter Pattern in Kotlin</a>
                
            </li>
            
            <li>
                June 7, 2021 -
                
                    <a href="/kotlin-facade-pattern/">Facade Pattern in Kotlin</a>
                
            </li>
            
            <li>
                May 30, 2021 -
                
                    <a href="/kotlin-strategy-pattern/">Strategy Pattern in Kotlin</a>
                
            </li>
            
            <li>
                May 13, 2021 -
                
                    <a href="/kotlin-template-method/">Kotlin Template Method</a>
                
            </li>
            
            <li>
                March 2, 2021 -
                
                    <a href="/kotlin-abstract-factory/">Kotlin Abstract Factory</a>
                
            </li>
            
            <li>
                February 26, 2021 -
                
                    <a href="/kotlin-factory-method/">Kotlin Factory Method</a>
                
            </li>
            
            <li>
                February 14, 2021 -
                
                    <a href="/kotlin-static-factory-methods/">Kotlin Static Factory Methods</a>
                
            </li>
            
            <li>
                January 29, 2021 -
                
                    <a href="/kotlin-builder-pattern/">Kotlin Builder Pattern</a>
                
            </li>
            
        </ul>
    </p>
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#abstract">Abstract</a>
      <ul>
        <li><a href="#return-result">Return Result</a></li>
        <li><a href="#commandprocessor">CommandProcessor</a></li>
        <li><a href="#undo">Undo</a></li>
        <li><a href="#why-not-just-use-lambdas">Why not just use lambdas?</a></li>
      </ul>
    </li>
    <li><a href="#home-automation-example">Home Automation example</a></li>
  </ul>

  <ul>
    <li><a href="#pros">Pros</a></li>
    <li><a href="#cons">Cons</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>



  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.esm.min.mjs';
    
    const lsTheme = localStorage.getItem("theme")
    const hugoTheme = document.body.classList.contains("dark-theme") ? "dark" : null
    const currTheme = lsTheme ? lsTheme : hugoTheme;
    const mermaidTheme = currTheme == "light" ? "default" : "dark"

    mermaid.initialize({
      theme: mermaidTheme, 
      startLoaded: true,
      logLevel: 1
    });
  </script>
