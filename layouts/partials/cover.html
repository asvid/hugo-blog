{{- $cover := false -}}
{{- $autoCover := default $.Site.Params.autoCover false }}

{{- if index .Params "cover" -}}
{{- if .Resources.GetMatch .Params.Cover }}
{{- $cover = (.Resources.GetMatch .Params.Cover).RelPermalink -}}
{{- else -}}
{{- $cover = absURL .Params.Cover -}}
{{- end -}}
{{- else if index .Params "image" -}}
{{- if .Resources.GetMatch .Params.image }}
{{- $cover = (.Resources.GetMatch .Params.image).RelPermalink -}}
{{- else -}}
{{- $cover = absURL .Params.image -}}
{{- end -}}
{{- else if $.Site.Params.AutoCover -}}
{{- if (not .Params.Cover) -}}
{{- if .Resources.GetMatch "cover.*" -}}
{{- $cover = (.Resources.GetMatch "cover.*").RelPermalink -}}
{{- end -}}
{{- end -}}
{{- end -}}

{{if $cover -}}
<!-- Cover image found -->
<a href="{{ .Permalink }}">
    <img src="{{ $cover }}"
         class="post-cover"
         alt="{{ .Title | plainify | default " " }}"
    title="{{ .Params.CoverCredit |plainify|default "Cover Image" }}" />
</a>
{{- end }}